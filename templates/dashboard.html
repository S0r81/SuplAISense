{% extends "base.html" %}

{% block content %}
  <div class="card-wrapper">

    <div class="card">

      <h1 class="center">Dashboard</h1>
      <p class="center">You are currently logged in.</p>

      <div class="center">
        <a href="/user/signout" class="btn btn--secondary">Sign Out</a>
      </div>
    
    </div>

    <div class="card">

      <h2 class="center">Your Info</h2>

      <p>
        <strong>ID:</strong> {{ session['user']['_id'] }}<br>
        <strong>Name:</strong> {{ session['user']['name'] }}<br>
        <strong>Email:</strong> {{ session['user']['email'] }}
      </p>
    
      <form action="/upload" method="POST" enctype="multipart/form-data">
        <label for="file">Upload PDF:</label>
        <input type="file" name="file" id="file" accept=".pdf">
        <input type="submit" value="Upload">
    </form>
    
    </div>

    <div class="card">
      <h2 class="center">Your Uploaded PDFs</h2>
      <div id="pdfList"></div>
    </div>
  </div>

  {% block scripts %}
  <script>
  async function getPdfs() {
    const response = await fetch('/get_uploaded_pdfs');
    const pdfs = await response.json();
  
    const pdfList = document.getElementById('pdfList');
    pdfs.forEach(pdf => {
      const pdfLink = document.createElement('a');
      pdfLink.href = pdf.url;
      pdfLink.textContent = pdf.filename;
      pdfLink.target = '_blank'; // Open PDF in a new tab
      pdfLink.className = 'pdf-link'; // Add a class for styling (optional)
  
      const listItem = document.createElement('li');
      listItem.appendChild(pdfLink);
  
      pdfList.appendChild(listItem);
    });
  }
  
  getPdfs();
  </script>
  {% endblock %}

{% endblock %}